<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Circle of Life (Live)</title>
  <style>
    :root{
      --bg1:#071a12; --bg2:#0b2a1d;
      --card: rgba(255,255,255,.08);
      --cardBorder: rgba(255,255,255,.14);
      --text:#ecfdf5; --muted: rgba(236,253,245,.72);
      --shadow: 0 12px 40px rgba(0,0,0,.35);
    }
    body{
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      margin:0; color: var(--text); min-height:100vh;
      background:
        radial-gradient(1200px 700px at 20% 10%, rgba(52,211,153,.16), transparent 55%),
        radial-gradient(1000px 600px at 90% 30%, rgba(34,197,94,.14), transparent 60%),
        linear-gradient(160deg, var(--bg1), var(--bg2));
    }
    .wrap{ max-width:1100px; margin:0 auto; padding:22px; }
    h1{ margin:8px 0 14px; font-size:26px; }
    h2{ margin:18px 0 10px; font-size:16px; color:var(--muted); font-weight:650; text-transform:uppercase; }

    .row{
      display:grid;
      grid-template-columns: 220px 1fr 1fr 1fr;
      gap:14px;
      align-items:stretch;
    }
    .card{
      background: var(--card);
      border: 1px solid var(--cardBorder);
      border-radius: 16px;
      padding: 14px 14px 12px;
      min-width: 0;
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
    }
    .big{ font-size:20px; font-weight:780; display:flex; gap:8px; align-items:center; }
    .muted{ margin-top:8px; color:var(--muted); font-size:13px; line-height:1.3; }
    .badge{
      display:inline-flex; align-items:center; gap:6px;
      padding: 6px 10px; border-radius: 999px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.06);
      font-size:12px; color: var(--muted);
    }
    .badge.ok{ border-color: rgba(52,211,153,.35); background: rgba(52,211,153,.10); color:#bbf7d0; }
    .badge.warn{ border-color: rgba(245,158,11,.45); background: rgba(245,158,11,.12); color:#fde68a; }

    .probas{ margin-top:8px; color:var(--muted); font-size:12px; line-height:1.35; }
    .probas b{ color: rgba(236,253,245,.92); font-weight:700; }

    .controls{ display:grid; gap:10px; padding:10px 0 4px; }
    .ctrl-row{ display:flex; flex-wrap:wrap; gap:10px; align-items:center; }
    .ctrl-spacer{ flex: 1 1 auto; }

    button, input{
      padding:10px 12px; border-radius:12px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.06);
      color: var(--text); outline:none;
    }
    input{ width:120px; }
    button{ cursor:pointer; font-weight:650; }
    button:hover{ background: rgba(255,255,255,.10); border-color: rgba(255,255,255,.26); }

    .btn-primary{ border-color: rgba(52,211,153,.35); background: rgba(52,211,153,.12); }
    .btn-warn{ border-color: rgba(245,158,11,.45); background: rgba(245,158,11,.14); }
    .btn-danger{ border-color: rgba(239,68,68,.55); background: rgba(239,68,68,.16); }

    #log{
      white-space: pre-wrap;
      background: rgba(0,0,0,.25);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 16px;
      padding: 12px;
      max-height: 260px;
      overflow: auto;
      color: var(--muted);
      box-shadow: var(--shadow);
    }
    .footerNote{ margin-top:10px; color: rgba(236,253,245,.55); font-size:12px; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Circle of Life (Live)</h1>

    <div class="row">
      <div class="card">
        <div class="big">Tick: <span id="tick">-</span></div>
        <div class="muted">√âtat: <span id="mode" class="badge">-</span></div>
      </div>

      <div class="card">
        <div class="big">üåø Herbe: <span id="grass">-</span></div>
        <div class="muted">Ressource globale de l'√©cosyst√®me.</div>
      </div>

      <div class="card">
        <div class="big">üêá Proies: <span id="preys">-</span></div>
        <div class="muted">√ânergie (min/avg/max): <span id="preyE">-</span></div>
        <div class="probas">
          <div>Manger: <b><span id="preyEatP">70</span>%</b></div>
          <div>Reproduction: <b><span id="preyRepP">25</span>%</b></div>
        </div>
      </div>

      <div class="card">
        <div class="big">ü¶Å Pr√©dateurs: <span id="preds">-</span></div>
        <div class="muted">√ânergie (min/avg/max): <span id="predE">-</span></div>
        <div class="probas">
          <div>Chasse: <b><span id="predHuntP">60</span>%</b></div>
          <div>Reproduction: <b><span id="predRepP">20</span>%</b></div>
        </div>
      </div>
    </div>

    <h2>Contr√¥les</h2>
    <div class="controls">
      <div class="ctrl-row">
        <button class="btn-warn" onclick="sendCmd('drought_on')">üåµ S√©cheresse ON</button>
        <button class="btn-primary" onclick="sendCmd('drought_off')">üå± Normal</button>

        <span class="muted" style="margin-left:6px;">Herbe:</span>
        <input id="grassInput" type="number" value="100" min="0" />
        <button class="btn-primary" onclick="setGrass()">Appliquer</button>
      </div>

      <div class="ctrl-row">
        <button class="btn-primary" onclick="sendCmd('add_prey',{value:1})">+1 proie</button>
        <span class="muted">Ajouter X proies:</span>
        <input id="preyAddInput" type="number" value="1" min="1" />
        <button class="btn-primary" onclick="addPreys()">Ajouter</button>

        <span class="ctrl-spacer"></span>

        <button class="btn-primary" onclick="sendCmd('add_predator',{value:1})">+1 pr√©dateur</button>
        <span class="muted">Ajouter X pr√©dateurs:</span>
        <input id="predAddInput" type="number" value="1" min="1" />
        <button class="btn-primary" onclick="addPreds()">Ajouter</button>
      </div>

      <div class="ctrl-row">
        <button class="btn-danger" onclick="sendCmd('reset')">Reset (√©tat initial)</button>
      </div>
    </div>

    <h2>Journal</h2>
    <div id="log"></div>
    <div class="footerNote">Actualisation automatique toutes les 300 ms.</div>
  </div>

<script>
  // Mets ici l‚ÄôURL de ton backend Python (obligatoire pour GitHub Pages)
  const BACKEND_BASE = "https://TON_BACKEND_ICI"; // ex: https://xxx.onrender.com

  const logEl = document.getElementById('log');

  async function sendCmd(cmd, args){
    try{
      const res = await fetch(`${BACKEND_BASE}/api/cmd`, {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({cmd, args: args || {}})
      });
      const data = await res.json();
      // pas de log ici: le journal doit venir du backend
      if(!data.ok){
        logEl.textContent = `Erreur cmd: ${data.error || 'unknown'}\n` + logEl.textContent;
      }
    }catch(e){
      logEl.textContent = `Erreur r√©seau: ${e}\n` + logEl.textContent;
    }
  }

  function setGrass(){
    const v = parseInt(document.getElementById('grassInput').value, 10);
    if(Number.isFinite(v) && v >= 0) sendCmd('set_grass', {value:v});
  }

  function addPreys(){
    const v = parseInt(document.getElementById('preyAddInput').value, 10);
    if(Number.isFinite(v) && v > 0) sendCmd('add_prey', {value:v});
  }

  function addPreds(){
    const v = parseInt(document.getElementById('predAddInput').value, 10);
    if(Number.isFinite(v) && v > 0) sendCmd('add_predator', {value:v});
  }

  async function refresh(){
    try{
      const res = await fetch(`${BACKEND_BASE}/api/state`, {cache:'no-store'});
      const s = await res.json();
      if(!s.ok){
        const modeEl = document.getElementById('mode');
        modeEl.textContent = 'en attente‚Ä¶';
        modeEl.className = 'badge';
        return;
      }

      document.getElementById('tick').textContent = s.tick;
      document.getElementById('grass').textContent = s.grass;
      document.getElementById('preys').textContent = s.preys;
      document.getElementById('preds').textContent = s.predators;

      const modeEl = document.getElementById('mode');
      modeEl.textContent = s.drought ? 'S√âCHERESSE' : 'Normal';
      modeEl.className = s.drought ? 'badge warn' : 'badge ok';

      const pe = s.prey_energy;
      const pr = s.pred_energy;
      document.getElementById('preyE').textContent = `${pe.min.toFixed(0)} / ${pe.avg.toFixed(1)} / ${pe.max.toFixed(0)}`;
      document.getElementById('predE').textContent = `${pr.min.toFixed(0)} / ${pr.avg.toFixed(1)} / ${pr.max.toFixed(0)}`;

      if (Array.isArray(s.logs)) {
        logEl.textContent = s.logs.join("\n");
      }
    }catch(e){
      logEl.textContent = `Erreur refresh: ${e}\n` + logEl.textContent;
    }
  }

  setInterval(refresh, 300);
  refresh();
</script>
</body>
</html>
